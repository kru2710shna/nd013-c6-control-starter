# Control and Trajectory Tracking for Autonomous Vehicle

## Proportional-Integral-Derivative (PID)

# File project/pid_controller.cpp and pid_conroller.h

### Class Summary (PID)
The PID class implements a PID controller to minimize the cross-track error (CTE) in self-driving car applications. It computes control outputs based on proportional, integral, and derivative errors while enforcing limits.

### Member Variables:
p_error, i_error, d_error:
Store the proportional, integral, and derivative errors.

Kp, Ki, Kd:
The PID gain coefficients for proportional, integral, and derivative control.

output_lim_max, output_lim_min:
Define the upper and lower bounds for the output control value.

delta_time:
Time interval between updates; used for integral and derivative calculations.

### Functions:
PID() (Constructor)
Initializes the PID object.

~PID() (Destructor)
Cleans up PID resources (default behavior here).

Init(double Kp, double Ki, double Kd, double output_lim_max, double output_lim_min)
Sets PID gains, output limits, and resets errors and delta time.

UpdateError(double cte, bool debugMode)
Updates p_error, i_error, and d_error using the new cross-track error (cte) and time step. Optional debug logging.

TotalError()
Computes the total PID output using the error terms and clamps it within [output_lim_min, output_lim_max].

UpdateDeltaTime(double new_delta_time)
Updates the time difference between controller updates and returns it.

## File Project/main.cpp

High-Level Summary

The code implements a self-driving car path planning and control loop using Carla simulator, where:

A Behavior Planner determines high-level maneuvers (e.g., STOPPED).
A Motion Planner generates candidate paths (spirals) based on the vehicle's goal.
Two PID controllers (for steering and throttle) are used to minimize the control error.
Control values are computed and sent via WebSocket (uWS) to actuate the vehicle.
Performance data is logged to text files for visualization or analysis.

## Results 
![Figure_1](https://github.com/user-attachments/assets/85bacadf-53ba-4e1c-b7d9-089ca47237d1)

Figure Overview:
X-axis: Iteration number (presumably time steps).
Y-axis: Error and control values (in radians or normalized steering command).
Lines:
ðŸ”µ Blue Line â€“ Error Steering: Angular difference between vehicle heading and desired trajectory.
ðŸŸ  Orange Line â€“ Steering Output: Control value generated by the PID controller to minimize steering error.

Observations & Analysis:

PID Responsiveness
The orange curve closely tracks the blue curve, especially in the mid and later iterations.
This shows the PID controller is effectively responding to the error with proportional + derivative corrections.

Error Reduction Over Time
In early iterations (0â€“20), error values are more erratic.
From around iteration 40 onward, both error and output begin to stabilize, suggesting the controller is learning or adapting to the trajectory.

Noise or Sudden Disturbances
Sharp spikes (e.g., at iterations ~35, 55, 70) show sudden increases in error.
The controller reacts strongly (possibly overshoots), which might be due to:
Sudden path curvature changes
Sharp turns or localization inaccuracies
High derivative gain (Kd)


ðŸ”„ Convergence Behavior
After about iteration 85, the curves appear smoother and center around zero, indicating better trajectory tracking.
This could imply the vehicle is reaching steady-state performance.

### Accuracy	-> Good â€” error hovers around zero after stabilization.
### Responsiveness	Strong â€” controller reacts quickly, but may spike with sharp error changes.
### Stability	Improves with time â€” less jitter and overshoot in later iterations.
### Potential Improvement	Tune down Kd slightly to reduce sharp output spikes or add derivative filtering.


## Result-2 
![Figure_2](https://github.com/user-attachments/assets/9c4994ac-2d04-4c85-8781-033655d786b1)

Figure Overview
X-axis: Iteration number (time steps).
Y-axis: Error and control values.
Curves:
ðŸ”µ Error Throttle â€“ difference between desired and actual speed.
ðŸŸ  Brake Output â€“ PID output for deceleration (if throttle output is negative).
ðŸŸ¢ Throttle Output â€“ PID output for acceleration.

Observations & Interpretation

Initial Oscillations (Iteration 0â€“15)
Throttle error is very high and fluctuating early on, reaching peaks >3.
Throttle output reacts accordingly with oscillations, and brake is briefly active, which suggests:
Poor initial speed matching
Sudden speed target shifts or vehicle instability
PID possibly not yet stabilized

Convergence & Stability (After Iteration ~20)
The error stabilizes around 1.0â€“1.2 indicating a consistent difference between target and actual speed.
However, the throttle output remains constant (~0.45), and brake stays at 0, which suggests:
The PID controller is only accelerating and never needs to decelerate.
The system might be under-compensating (i.e., the speed error never fully diminishes).

Throttle Clipped or Underpowered
The throttle output is flat, even as the error fluctuates slightly â€” this suggests the controller may:
Be hitting an internal cap (output_lim_max)
Have a low Kp or Ki gain, leading to sluggish adjustment
Or the error is not reducing, meaning the system can't reach target speed (perhaps due to simulator limits or friction model)

Sudden Spike Near Iteration 100
Error suddenly drops and rises again sharply.
The PID response (throttle) slightly dips but doesnâ€™t adapt quickly â€” a sign that the integral or derivative components are weak.

### Responsiveness	Slow, particularly after the first 20 iterations.
### Accuracy	Moderate â€” error stabilizes but doesn't drop to 0.
### Brake Use	Minimal â€” indicates error is consistently under target speed.
### Potential Issues	Low PID gains or throttle saturation limiting control power.

## What is the effect of the PID according to the plots, how each part of the PID affects the control command?
The PID controller in this project plays a crucial role in maintaining smooth and accurate vehicle control by continuously adjusting steering and throttle commands. As demonstrated in the plots, the controller works to minimize the difference between the expected and actual values for vehicle speed and yaw angle, resulting in improved trajectory tracking and system stability.

To achieve fast error reduction without overshooting, the PID controllerâ€™s parameters were carefully tuned. Each component â€” Proportional (P), Integral (I), and Derivative (D) â€” contributes uniquely to the overall behavior of the control system.

Proportional (P) Control generates an output directly related to the current error value. It provides immediate correction by pushing the system toward the desired value. However, an excessively high P gain can make the vehicle unstable, especially during sharp turns or when it starts far off from the target path. While a properly tuned P term enhances responsiveness, it usually cannot eliminate steady-state error by itself.
Integral (I) Control accumulates past errors over time, addressing any residual steady-state error that the P controller alone cannot eliminate. It adjusts the control signal to account for long-term drift or bias. If tuned correctly, the I component helps the vehicle correct persistent small deviations from the target. But if the I gain is too high, it may lead to delayed responses or even instability due to excessive correction.
Derivative (D) Control anticipates the systemâ€™s future behavior by considering the rate of error change. This term helps to dampen the response, reducing oscillations and preventing overshoot. A moderate D gain can lead to quicker, smoother convergence to the desired trajectory. However, too much derivative action can overly slow down the system (overdamped), while too little may result in persistent oscillations (underdamped).
Overall, with a well-tuned balance of these three components, the PID controller ensures the vehicle can follow the planned path smoothly and react appropriately to changes. The control system becomes not only responsive but also stable and precise â€” key requirements for autonomous driving performance.


## How would you design a way to automatically tune the PID parameters?
Implementing twiddle algorithm to optimize a set of parameters which was covered in PID control Parameter Optimization lesson. By offering initial values for the PID parameters and probing intervals we can run the PID controller and analyze the control output and tweaking the parameters up and down by examining the outcome, calculates the new quality marker and replaces the parameters only if the result is better.



## Final Images 



![final_output-1](https://github.com/user-attachments/assets/5e810c59-8538-41d5-96ac-ed96de693178)
![final_project_output_2](https://github.com/user-attachments/assets/f756a991-8cb3-4aa8-9265-c770fadc4f50)
![final_project_output_3](https://github.com/user-attachments/assets/4447d85e-57a5-4538-aed3-7d96dd831732)
![final_project_output_4](https://github.com/user-attachments/assets/8fb57edd-5707-4efc-8400-c79bdf6776bd)
![final_project_output_5](https://github.com/user-attachments/assets/f6965d5a-2125-458e-ae9d-aa9074f2c94a)
![final_project_output_6](https://github.com/user-attachments/assets/25433333-fe12-4dd0-ad6e-cd81b06645b1)
![final_project_output_7](https://github.com/user-attachments/assets/9b480f07-959b-44b1-a94a-bee2ef448cdb)
![final_project_output_8](https://github.com/user-attachments/assets/d28e3809-713e-4b60-9e30-3e392e17383f)
![final_project_output_9](https://github.com/user-attachments/assets/f6e22cbb-a6c9-41ea-9cc7-ef928b07ede9)
![final_project_output_10](https://github.com/user-attachments/assets/3cf6457d-a01c-4c16-8636-73c3a3178133)
![final_project_output_11](https://github.com/user-attachments/assets/0fad5e71-5344-47c2-9205-57b0030ac40a)
![final_project_output_12](https://github.com/user-attachments/assets/ad623498-2d82-438c-82cf-f486c79f648f)
![final_project_output_13](https://github.com/user-attachments/assets/1f3edaa7-51da-46bb-b7ea-650f6b5fae08)








